# OpenCode Platform - å¾Œç«¯æ¶æ§‹èªªæ˜

> **ç‰ˆæœ¬**: v5.6.1  
> **æŠ€è¡“æ£§**: Python 3.11 + FastAPI + Qdrant  
> **ä»£ç¢¼é‡**: ~15,000 è¡Œ

---

## ğŸ“ å¾Œç«¯ç›®éŒ„çµæ§‹

```
src/opencode/
â”‚
â”œâ”€â”€ ğŸ“ api/                          # API å±¤ (FastAPI)
â”‚   â”œâ”€â”€ main.py                      # ä¸»æ‡‰ç”¨å…¥å£ï¼Œè·¯ç”±è¨»å†Š
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ chat.py                  # å°è©± API (SSE ä¸²æµ)
â”‚       â”œâ”€â”€ documents.py             # æ–‡ä»¶ç®¡ç† API
â”‚       â”œâ”€â”€ research.py              # æ·±åº¦ç ”ç©¶ API
â”‚       â””â”€â”€ qdrant.py                # å‘é‡è³‡æ–™åº« API
â”‚
â”œâ”€â”€ ğŸ“ agents/                       # Multi-Agent ç³»çµ± â­
â”‚   â”œâ”€â”€ base.py                      # Agent åŸºé¡å®šç¾©
â”‚   â”œâ”€â”€ coordinator.py               # Agent å”èª¿å™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ dispatcher.py                # ç¸½æ©Ÿ Agentï¼ˆæ„åœ–è­˜åˆ¥ï¼‰
â”‚   â”œâ”€â”€ specialists.py               # å°ˆæ¥­ Agents
â”‚   â”‚   â”œâ”€â”€ ResearcherAgent          # ç ”ç©¶å“¡
â”‚   â”‚   â”œâ”€â”€ WriterAgent              # å¯«æ‰‹
â”‚   â”‚   â”œâ”€â”€ CoderAgent               # ç¨‹å¼å¸«
â”‚   â”‚   â”œâ”€â”€ AnalystAgent             # åˆ†æå¸«
â”‚   â”‚   â””â”€â”€ ReviewerAgent            # å¯©ç¨¿å“¡
â”‚   â””â”€â”€ tools.py                     # Agent å·¥å…·è¨»å†Š
â”‚
â”œâ”€â”€ ğŸ“ services/                     # æœå‹™å±¤
â”‚   â””â”€â”€ knowledge_base/              # RAG çŸ¥è­˜åº«æœå‹™ â­
â”‚       â”œâ”€â”€ service.py               # ä¸»æœå‹™å…¥å£
â”‚       â”œâ”€â”€ parser.py                # PDF è§£æï¼ˆDocling/PyMuPDFï¼‰
â”‚       â”œâ”€â”€ indexer.py               # å‘é‡ç´¢å¼•ï¼ˆCohere + Qdrantï¼‰
â”‚       â””â”€â”€ retriever.py             # èªæ„æœå°‹
â”‚
â”œâ”€â”€ ğŸ“ plugins/                      # æ’ä»¶ç³»çµ± â­
â”‚   â”œâ”€â”€ manager.py                   # æ’ä»¶ç®¡ç†å™¨ï¼ˆç†±æ’æ‹”ï¼‰
â”‚   â”œâ”€â”€ routes.py                    # æ’ä»¶ API
â”‚   â””â”€â”€ sandbox.py                   # æ’ä»¶æ²™ç®±åŸ·è¡Œ
â”‚
â”œâ”€â”€ ğŸ“ workflow/                     # å·¥ä½œæµå¼•æ“
â”‚   â”œâ”€â”€ __init__.py                  # å·¥ä½œæµæ ¸å¿ƒé‚è¼¯
â”‚   â””â”€â”€ routes.py                    # å·¥ä½œæµ API
â”‚
â”œâ”€â”€ ğŸ“ sandbox/                      # ä»£ç¢¼æ²™ç®± â­
â”‚   â”œâ”€â”€ __init__.py                  # Docker æ²™ç®±åŸ·è¡Œ
â”‚   â””â”€â”€ routes.py                    # æ²™ç®± API
â”‚
â”œâ”€â”€ ğŸ“ auth/                         # èªè­‰æˆæ¬Š
â”‚   â”œâ”€â”€ jwt.py                       # JWT Token è™•ç†
â”‚   â”œâ”€â”€ service.py                   # ç”¨æˆ¶æœå‹™
â”‚   â”œâ”€â”€ models.py                    # ç”¨æˆ¶æ¨¡å‹
â”‚   â””â”€â”€ routes.py                    # èªè­‰ API
â”‚
â”œâ”€â”€ ğŸ“ control_plane/                # æ§åˆ¶å¹³é¢
â”‚   â”œâ”€â”€ audit/                       # å¯©è¨ˆæ—¥èªŒ
â”‚   â”œâ”€â”€ cost/                        # æˆæœ¬è¿½è¹¤
â”‚   â”œâ”€â”€ policy/                      # æ¬Šé™ç­–ç•¥
â”‚   â””â”€â”€ ops/                         # é‹ç¶­ç›£æ§
â”‚
â”œâ”€â”€ ğŸ“ marketplace/                  # æ’ä»¶å¸‚å ´
â”‚   â”œâ”€â”€ service.py
â”‚   â””â”€â”€ routes.py
â”‚
â”œâ”€â”€ ğŸ“ core/                         # æ ¸å¿ƒæ¨¡çµ„
â”‚   â”œâ”€â”€ protocols.py                 # å”è­°å®šç¾©ï¼ˆEvent, Intentï¼‰
â”‚   â”œâ”€â”€ events.py                    # äº‹ä»¶ç³»çµ±
â”‚   â”œâ”€â”€ context.py                   # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â””â”€â”€ engine.py                    # ä¸»å¼•æ“
â”‚
â”œâ”€â”€ ğŸ“ config/                       # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ settings.py                  # Pydantic Settings
â”‚
â””â”€â”€ ğŸ“ tools/                        # å·¥å…·æ¨¡çµ„
    â””â”€â”€ rag_tool.py                  # RAG æœå°‹å·¥å…·
```

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ§‹

### 1. Multi-Agent å”ä½œç³»çµ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AgentCoordinator                             â”‚
â”‚                    (agents/coordinator.py)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ç”¨æˆ¶è¼¸å…¥ â”€â”€â”€â–º Dispatcher â”€â”€â”€â–º ä»»å‹™åˆ†æ´¾ â”€â”€â”€â–º å°ˆæ¥­ Agent       â”‚
â”‚                (æ„åœ–è­˜åˆ¥)         â”‚                              â”‚
â”‚                                   â–¼                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                          â”‚   Researcher  â”‚ â† RAG æœå°‹           â”‚
â”‚                          â”‚   Writer      â”‚ â† æ–‡æ¡ˆæ’°å¯«           â”‚
â”‚                          â”‚   Coder       â”‚ â† ä»£ç¢¼ç”Ÿæˆ           â”‚
â”‚                          â”‚   Analyst     â”‚ â† æ•¸æ“šåˆ†æ           â”‚
â”‚                          â”‚   Reviewer    â”‚ â† å“è³ªå¯©æ ¸           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                   â”‚                              â”‚
â”‚                                   â–¼                              â”‚
â”‚                          çµæœèšåˆ â”€â”€â”€â–º å›æ‡‰ç”¨æˆ¶                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. RAG çŸ¥è­˜åº«æµç¨‹

```
PDF ä¸Šå‚³
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Parser     â”‚  â† Docling / PyMuPDF
â”‚  (è§£ææ–‡ä»¶)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Chunker    â”‚  â† æ™ºèƒ½åˆ†å¡Š (500 tokens, 50 overlap)
â”‚  (æ–‡å­—åˆ†å¡Š)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Indexer    â”‚  â† Cohere embed-multilingual-v3.0
â”‚  (å‘é‡ç´¢å¼•)   â”‚     Qdrant å‘é‡å­˜å„²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Retriever   â”‚  â† èªæ„æœå°‹ + ç›¸é—œæ€§è©•åˆ†
â”‚  (èªæ„æœå°‹)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    LLM      â”‚  â† GPT-4o ç”Ÿæˆå›ç­”
â”‚  (ç­”æ¡ˆç”Ÿæˆ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ’ä»¶ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PluginManager                               â”‚
â”‚                   (plugins/manager.py)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ AgentPlugin â”‚  â”‚ ToolPlugin  â”‚  â”‚ServicePluginâ”‚             â”‚
â”‚  â”‚  (Agent å‹) â”‚  â”‚  (å·¥å…·å‹)   â”‚  â”‚  (æœå‹™å‹)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                â”‚                â”‚                      â”‚
â”‚         â–¼                â–¼                â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚              Sandbox Execution                   â”‚            â”‚
â”‚  â”‚            (å®‰å…¨æ²™ç®±åŸ·è¡Œç’°å¢ƒ)                    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â”‚  åŠŸèƒ½ï¼š                                                          â”‚
â”‚  â€¢ ç†±æ’æ‹”ï¼ˆç„¡éœ€é‡å•Ÿï¼‰                                           â”‚
â”‚  â€¢ ZIP ä¸Šå‚³å®‰è£                                                 â”‚
â”‚  â€¢ Git Clone å®‰è£                                               â”‚
â”‚  â€¢ ä¾è³´è‡ªå‹•å®‰è£                                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ ä¸»è¦ API ç«¯é»

| ç«¯é» | æ–¹æ³• | èªªæ˜ | æ–‡ä»¶ä½ç½® |
|------|------|------|----------|
| `/api/chat/stream` | POST | SSE ä¸²æµå°è©± | api/routes/chat.py |
| `/api/research/deep` | POST | æ·±åº¦ç ”ç©¶ | api/routes/research.py |
| `/api/upload` | POST | ä¸Šå‚³æ–‡ä»¶ | api/routes/documents.py |
| `/api/documents` | GET | æ–‡ä»¶åˆ—è¡¨ | api/routes/documents.py |
| `/api/search` | POST | èªæ„æœå°‹ | api/routes/documents.py |
| `/api/sandbox/execute` | POST | åŸ·è¡Œä»£ç¢¼ | sandbox/routes.py |
| `/api/plugins` | GET | æ’ä»¶åˆ—è¡¨ | plugins/routes.py |
| `/api/plugins/{id}/reload` | POST | ç†±é‡è¼‰æ’ä»¶ | plugins/routes.py |
| `/api/workflows` | GET/POST | å·¥ä½œæµç®¡ç† | workflow/routes.py |
| `/api/agents` | GET | Agent åˆ—è¡¨ | agents/routes.py |
| `/auth/login` | POST | ç”¨æˆ¶ç™»å…¥ | auth/routes.py |

---

## ğŸ”§ é—œéµæŠ€è¡“å¯¦ç¾

### 1. SSE ä¸²æµå›æ‡‰

```python
# api/routes/chat.py
@router.post("/chat/stream")
async def chat_stream(request: ChatRequest):
    async def event_generator():
        async for event in coordinator.process(request.message):
            yield {
                "event": event.type,
                "data": json.dumps(event.data)
            }
    
    return EventSourceResponse(event_generator())
```

### 2. Agent å”èª¿å™¨

```python
# agents/coordinator.py
class AgentCoordinator:
    async def process(self, message: str) -> AsyncGenerator[Event, None]:
        # 1. æ„åœ–è­˜åˆ¥
        intent = await self.dispatcher.recognize(message)
        
        # 2. åˆ†æ´¾ä»»å‹™
        tasks = self.create_tasks(intent)
        
        # 3. ä¸¦è¡ŒåŸ·è¡Œ
        results = await asyncio.gather(*[
            agent.execute(task) for agent, task in tasks
        ])
        
        # 4. èšåˆçµæœ
        yield self.aggregate(results)
```

### 3. æ’ä»¶ç†±é‡è¼‰

```python
# plugins/manager.py
async def reload_plugin(self, plugin_id: str) -> bool:
    # 1. å¸è¼‰ç¾æœ‰æ’ä»¶
    await self.unload_plugin(plugin_id)
    
    # 2. æ¸…é™¤æ¨¡çµ„å¿«å–
    module_name = f"plugins.{plugin_id}"
    if module_name in sys.modules:
        del sys.modules[module_name]
    
    # 3. é‡æ–°è¼‰å…¥
    return await self.load_plugin(plugin_id)
```

---

## ğŸ“Š æŠ€è¡“æŒ‡æ¨™

| æŒ‡æ¨™ | æ•¸å€¼ |
|------|------|
| Python æ–‡ä»¶æ•¸ | ~80 å€‹ |
| ä»£ç¢¼è¡Œæ•¸ | ~15,000 è¡Œ |
| API ç«¯é»æ•¸ | ~30 å€‹ |
| Agent æ•¸é‡ | 5 + æ’ä»¶æ“´å±• |
| æ¸¬è©¦è¦†è“‹ç‡ | ~60% |

---

## ğŸ” å®‰å…¨è¨­è¨ˆ

1. **JWT èªè­‰** - æ‰€æœ‰ API éœ€è¦ Token
2. **RBAC æ¬Šé™** - è§’è‰²åŸºç¤å­˜å–æ§åˆ¶
3. **ä»£ç¢¼æ²™ç®±** - Docker éš”é›¢åŸ·è¡Œ
4. **è¼¸å…¥é©—è­‰** - Pydantic æ¨¡å‹é©—è­‰
5. **å¯©è¨ˆæ—¥èªŒ** - æ“ä½œè¨˜éŒ„è¿½è¹¤

---

## ğŸ“¦ ä¾è³´å¥—ä»¶

### æ ¸å¿ƒæ¡†æ¶
- FastAPI + Uvicorn
- Pydantic v2

### AI/LLM
- OpenAI SDK
- Cohere SDK
- Google Generative AI

### å‘é‡è³‡æ–™åº«
- Qdrant Client

### æ–‡ä»¶è™•ç†
- PyMuPDF
- python-docx
- pandas + openpyxl

---

**æ–‡æª”çµæŸ** | å¦‚éœ€æ›´å¤šç´°ç¯€ï¼Œè«‹æŸ¥çœ‹æºä»£ç¢¼è¨»é‡‹ã€‚
