# 引用統計快速指南 (Citation Statistics Quick Start)

## 🎯 為什麼這些數字是可靠的？

### 問題回答

**Q: 怎麼確保這些數字是合理不是瞎猜的？**

A: 完全不是猜的！系統使用**機械化掃描**報告內容：

1. **正則表達式掃描**：使用 `\[(\d+)\]` 模式掃描整個報告
2. **精確計數**：每找到一個引用就計數一次
3. **對比分類**：將找到的編號與參考文獻列表對比
4. **數學計算**：所有統計都是精確計算，不涉及估算

```python
# 核心邏輯（簡化版）
citation_pattern = r'\[(\d+)\]'  # 匹配 [1], [2], [3] 等
for match in re.finditer(citation_pattern, report_body):
    ref_num = int(match.group(1))
    citation_counts[ref_num] += 1  # 每找到一次就 +1
```

---

**Q: Agent 怎麼知道它引用了什麼？**

A: 通過**三步追蹤機制**：

1. **生成時記錄**：LLM 生成報告時使用 [1], [2], [3] 格式
2. **掃描時識別**：報告完成後掃描所有 `[數字]` 模式
3. **對比時分類**：將掃描結果與參考文獻 ID 列表對比

**示例**：
```markdown
報告內容：Recent AI advances [1] and [2] show promise [1].

掃描結果：
- [1] 出現 2 次 ✓
- [2] 出現 1 次 ✓

參考文獻：
[1] AI Report 2024      → 被引用 ✅ (2次)
[2] ML Study           → 被引用 ✅ (1次)
[3] Uncited Paper      → 未引用 ⬜
```

---

**Q: 怎麼知道哪些沒引用？**

A: **排除法邏輯**：

```python
所有文獻 = {1, 2, 3, 4, 5}
引用文獻 = {1, 2, 4}       # 從報告中掃描得到
未引用文獻 = {3, 5}         # 所有文獻 - 引用文獻
```

每個參考文獻都會被明確分類為：
- ✅ **引用**：ID 在報告中出現
- ⬜ **未引用**：ID 在報告中未出現

沒有模糊地帶！

## 🔍 如何手動驗證

### 步驟 1：查看你的報告

在報告末尾找到引用統計區塊：

```markdown
## 📊 引用統計 (Citation Statistics)

### 基本指標
- **實際引用文獻**: 48 篇
- **相關未引用文獻**: 439 篇
- **總查閱文獻**: 487 篇
- **引用率**: 9.9%

### 引用深度分析
- **總引用次數**: 156 次
- **平均每篇文獻被引用**: 3.2 次
- **最常引用**: [1] (15次), [5] (12次), [10] (9次)
```

### 步驟 2：手動驗證（可選）

在你的編輯器中：

1. **搜索引用**：使用正則表達式搜索 `\[\d+\]`
2. **統計數量**：
   ```bash
   # 在 Linux/Mac 上
   grep -o '\[[0-9]\+\]' report.md | sort | uniq -c
   ```
3. **對比結果**：你會發現與報告中的數字完全一致！

### 步驟 3：檢查列表

在報告中對比兩個區塊：

- **📚 參考文獻 (Cited References)**：這些在報告中出現過
- **📖 相關文獻 (Related Sources - Not Cited)**：這些沒出現過

## 🎨 新功能展示

### 1️⃣ 引用次數標記

現在每個引用文獻會顯示被引用次數：

```markdown
[1] **AI in Healthcare 2024** `×15`  ← 被引用15次
[2] **Medical Imaging AI** `×3`      ← 被引用3次
[3] **Healthcare Study** `×1`        ← 被引用1次
```

**意義**：
- `×15`：核心文獻，報告中多次引用
- `×1`：補充文獻，僅引用一次

### 2️⃣ 無效引用檢測

如果報告中引用了不存在的文獻編號（BUG），會顯示警告：

```markdown
⚠️ **警告**: 檢測到 2 個無效引用編號: [99, 100]
```

**這表示**：報告中出現了 [99] 和 [100]，但參考文獻列表中沒有這些編號。

### 3️⃣ 引用深度分析

**總引用次數** vs **引用文獻數**：

```
實際引用文獻: 48 篇     ← 有多少個不同的文獻被引用
總引用次數: 156 次      ← 這些文獻總共被引用了多少次
平均: 156 ÷ 48 = 3.2 次 ← 平均每篇文獻被引用 3.2 次
```

**解讀**：
- 平均 > 2：文獻被多次引用，報告深度較好
- 平均 ≈ 1：每個文獻只用一次，可能太表面
- 平均 > 5：少數核心文獻被重複引用

### 4️⃣ 最常引用排名

```markdown
- **最常引用**: [1] (15次), [5] (12次), [10] (9次)
```

**用途**：
- 快速識別核心文獻
- 了解報告依賴哪些來源
- 檢查是否過度依賴單一來源

## 🧪 快速測試

想親自驗證系統的準確性？運行測試：

```bash
# 基本測試
python3 tests/test_reference_categorization.py

# 完整功能測試（包含所有新功能）
python3 tests/test_enhanced_citation_stats.py
```

測試會創建模擬報告，然後驗證：
- ✅ 引用計數準確
- ✅ 無效引用被檢測
- ✅ 統計數字正確
- ✅ 排序正確

## 📊 實際案例

### 案例：研究報告質量檢查

**報告 A**：
```
實際引用文獻: 10 篇
總引用次數: 12 次
平均: 1.2 次
```
**分析**：文獻分佈均勻，但可能深度不足

**報告 B**：
```
實際引用文獻: 10 篇
總引用次數: 45 次
平均: 4.5 次
最常引用: [1] (15次), [2] (10次), [3] (8次)
```
**分析**：有明確的核心文獻，論述深度較好

**報告 C**：
```
實際引用文獻: 50 篇
總引用次數: 55 次
平均: 1.1 次
```
**分析**：引用數量多但都只用一次，可能是列舉式引用

## ❓ FAQ

### Q: 為什麼引用率只有 9.9%？

A: 這是正常的！引用率 = 實際引用 ÷ 查閱文獻

```
48 (實際引用) ÷ 487 (查閱文獻) = 9.9%
```

**原因**：
- 系統搜索了 487 個相關文獻
- 但只有 48 個真正對報告有貢獻
- 其他 439 個被瀏覽但未納入報告

這說明系統在**精心篩選**，不是無腦引用！

### Q: 如果看到無效引用警告怎麼辦？

這是 BUG 指示器！可能原因：
1. LLM 生成了不存在的引用編號
2. 參考文獻列表處理有問題
3. 引用格式解析錯誤

**建議**：報告此問題，並檢查報告中的對應位置。

### Q: 能否支持其他引用格式？

當前版本支援：`[1]`, `[2]`, `[123]` 等數字引用

未來可擴展支援：
- `(Author, 2024)` 格式
- 腳註引用
- APA/MLA 等學術格式

## 🎓 總結

**系統如何確保數字可靠**：

1. ✅ **精確掃描**：正則表達式不會遺漏或誤判
2. ✅ **完整追蹤**：每個引用都被記錄和計數
3. ✅ **數學驗證**：所有統計可以手動複現
4. ✅ **自動測試**：持續驗證系統準確性
5. ✅ **透明展示**：所有數據公開在報告中

**記住**：
- 這些數字是**計算出來的**，不是估算的
- 你可以**手動驗證**任何統計數據
- 系統會**警告異常**（如無效引用）

---

*需要更多幫助？查看完整文檔：`docs/CITATION_STATISTICS_ENHANCEMENT.md`*
